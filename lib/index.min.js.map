{"version":3,"file":"index.min.js","sources":["index.js"],"names":["global","deferred","promise","undefined","resolver","rejecter","Promise","resolve","reject","keys","prefix","regex","RegExp","Object","localStorage","filter","i","test","adapter","store","op","key","data","defer","record","adapters","local","id","lkey","result","getItem","map","JSON","parse","Error","removeItem","forEach","setItem","stringify","toArray","require","exports","module","define","haroLocalStorage","window"],"mappings":";;;;;;;;;;;AASA,cAEA,SAAWA,GAIV,QAASC,KACR,GAAIC,GAAUC,OACVC,EAAWD,OACXE,EAAWF,MAOf,OALAD,GAAU,GAAII,GAAQ,SAAUC,EAASC,GACxCJ,EAAWG,EACXF,EAAWG,KAGHD,QAASH,EAAUI,OAAQH,EAAUH,QAASA,GAGxD,QAASO,GAAKC,GACb,GAAIC,OAAQ,GAAIC,QAAO,IAAMF,EAAS,IAEtC,OAAOG,QAAOJ,KAAKK,GAAcC,OAAO,SAAUC,GACjD,MAAOL,OAAMM,KAAKD,KAIpB,QAASE,GAAQC,MAAOC,EAAIC,EAAKC,GAChC,GAAIC,GAAQtB,IACRuB,EAAiBrB,SAARkB,EACTX,EAASS,MAAMM,SAASC,OAASP,MAAMQ,GACvCC,EAAOlB,EAAS,IAAMW,EACtBQ,EAAS1B,MAwCb,OAtCW,QAAPiB,GAEFS,EADGL,EACMV,EAAagB,QAAQF,GAErBnB,EAAKC,GAAQqB,IAAI,SAAUf,GACnC,MAAOgB,MAAKC,MAAMnB,EAAagB,QAAQd,MAI1B,OAAXa,EACHN,EAAMhB,QAA0B,gBAAXsB,GAAsBG,KAAKC,MAAMJ,GAAUA,GACtDL,EACVD,EAAMf,OAAO,GAAI0B,OAAM,qCAEvBX,EAAMhB,aAEU,WAAPa,GACNI,EACHV,EAAaqB,WAAWP,GAExBnB,EAAKC,GAAQ0B,QAAQ,SAAUpB,GAC9BF,EAAaqB,WAAWnB,KAI1BO,EAAMhB,SAAQ,IACG,QAAPa,IACNI,EACHV,EAAauB,QAAQT,EAAMI,KAAKM,UAAUhB,IAE1CH,MAAMoB,UAAUH,QAAQ,SAAUpB,GACjCF,EAAauB,QAAQ3B,EAAS,IAAMM,EAAEG,MAAME,KAAMW,KAAKM,UAAUtB,MAInEO,EAAMhB,SAAQ,IAGRgB,EAAMrB,QArEd,GAAII,GAAUN,EAAOM,SAAWkC,QAAQ,eAAelC,QACnDQ,EAAed,EAAOc,cAAgB0B,QAAQ,eAwE3B,oBAAZC,SACVC,OAAOD,QAAUvB,EACW,kBAAXyB,QACjBA,OAAO,WACN,MAAOzB,KAGRlB,EAAO4C,iBAAmB1B,GAEP,mBAAXlB,QAAyBA,OAAS6C","sourcesContent":["/**\n * localStorage persistent storage adapter for Har≈ç\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2015\n * @license BSD-3-Clause\n * @link https://github.com/avoidwork/haro-localstorage\n * @version 1.1.0\n */\n\"use strict\";\n\n(function (global) {\n\tvar Promise = global.Promise || require(\"es6-promise\").Promise;\n\tvar localStorage = global.localStorage || require(\"localStorage\");\n\n\tfunction deferred() {\n\t\tvar promise = undefined,\n\t\t    resolver = undefined,\n\t\t    rejecter = undefined;\n\n\t\tpromise = new Promise(function (resolve, reject) {\n\t\t\tresolver = resolve;\n\t\t\trejecter = reject;\n\t\t});\n\n\t\treturn { resolve: resolver, reject: rejecter, promise: promise };\n\t}\n\n\tfunction keys(prefix) {\n\t\tvar regex = new RegExp(\"^\" + prefix + \"_\");\n\n\t\treturn Object.keys(localStorage).filter(function (i) {\n\t\t\treturn regex.test(i);\n\t\t});\n\t}\n\n\tfunction adapter(store, op, key, data) {\n\t\tvar defer = deferred(),\n\t\t    record = key !== undefined,\n\t\t    prefix = store.adapters.local || store.id,\n\t\t    lkey = prefix + \"_\" + key,\n\t\t    result = undefined;\n\n\t\tif (op === \"get\") {\n\t\t\tif (record) {\n\t\t\t\tresult = localStorage.getItem(lkey);\n\t\t\t} else {\n\t\t\t\tresult = keys(prefix).map(function (i) {\n\t\t\t\t\treturn JSON.parse(localStorage.getItem(i));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (result !== null) {\n\t\t\t\tdefer.resolve(typeof result === \"string\" ? JSON.parse(result) : result);\n\t\t\t} else if (record) {\n\t\t\t\tdefer.reject(new Error(\"Record not found in localStorage\"));\n\t\t\t} else {\n\t\t\t\tdefer.resolve([]);\n\t\t\t}\n\t\t} else if (op === \"remove\") {\n\t\t\tif (record) {\n\t\t\t\tlocalStorage.removeItem(lkey);\n\t\t\t} else {\n\t\t\t\tkeys(prefix).forEach(function (i) {\n\t\t\t\t\tlocalStorage.removeItem(i);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tdefer.resolve(true);\n\t\t} else if (op === \"set\") {\n\t\t\tif (record) {\n\t\t\t\tlocalStorage.setItem(lkey, JSON.stringify(data));\n\t\t\t} else {\n\t\t\t\tstore.toArray().forEach(function (i) {\n\t\t\t\t\tlocalStorage.setItem(prefix + \"_\" + i[store.key], JSON.stringify(i));\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tdefer.resolve(true);\n\t\t}\n\n\t\treturn defer.promise;\n\t}\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = adapter;\n\t} else if (typeof define === \"function\") {\n\t\tdefine(function () {\n\t\t\treturn adapter;\n\t\t});\n\t} else {\n\t\tglobal.haroLocalStorage = adapter;\n\t}\n})(typeof global !== \"undefined\" ? global : window);\n"]}