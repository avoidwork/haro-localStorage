{"version":3,"file":"index.min.js","sources":["index.js"],"names":["global","deferred","promise","undefined","resolver","rejecter","Promise","resolve","reject","local","store","op","key","data","defer","record","has","prefix","adapters","id","result","localStorage","getItem","JSON","parse","set","then","rec","e","Error","batch","args","removeItem","setItem","stringify","toArray","require","exports","module","define","haroLocal","window"],"mappings":";;;;;;;;;;;AASA,cAEA,SAAWA,GAIV,QAASC,KACR,GAAIC,GAAUC,OACVC,EAAWD,OACXE,EAAWF,MAOf,OALAD,GAAU,GAAII,GAAQ,SAAUC,EAASC,GACxCJ,EAAWG,EACXF,EAAWG,KAGHD,QAASH,EAAUI,OAAQH,EAAUH,QAASA,GAGxD,QAASO,GAAMC,MAAOC,EAAIC,EAAKC,GAC9B,GAAIC,GAAQb,IACRc,EAAiBZ,SAARS,GAAqBF,MAAMM,IAAIJ,GACxCK,EAASP,MAAMQ,SAAST,OAASC,MAAMS,GACvCC,EAASjB,MAsCb,IApCW,QAAPQ,IACCI,GACHK,EAASC,EAAaC,QAAQL,EAAS,IAAML,GAE9B,OAAXQ,GACHA,EAASG,KAAKC,MAAMJ,GACpBV,MAAMe,IAAIb,EAAKQ,GAAQ,GAAMM,KAAK,SAAUC,GAC3Cb,EAAMP,QAAQoB,IACZ,SAAUC,GACZd,EAAMN,OAAOoB,MAGdd,EAAMN,OAAO,GAAIqB,OAAM,qCAGxBnB,MAAMe,IAAIb,EAAKQ,GAAQ,GAAMM,KAAK,SAAUC,GAC3Cb,EAAMP,QAAQoB,IACZ,SAAUC,GACZd,EAAMN,OAAOoB,OAGdR,EAASC,EAAaC,QAAQL,GAEf,OAAXG,GACHA,EAASG,KAAKC,MAAMJ,GACpBV,MAAMoB,MAAMV,EAAQ,OAAOM,KAAK,SAAUK,GACzCjB,EAAMP,QAAQwB,IACZ,SAAUH,GACZd,EAAMN,OAAOoB,MAGdd,EAAMP,cAKE,WAAPI,EACH,IACKI,EACHM,EAAaW,WAAWf,EAAS,IAAML,GAEvCS,EAAaW,WAAWf,GAGzBH,EAAMP,SAAQ,GACb,MAAOqB,GACRd,EAAMN,OAAOoB,GAIf,GAAW,QAAPjB,EACH,IACKI,EACHM,EAAaY,QAAQhB,EAAS,IAAML,EAAKW,KAAKW,UAAUrB,IAExDQ,EAAaY,QAAQhB,EAAQM,KAAKW,UAAUxB,MAAMyB,YAGnDrB,EAAMP,SAAQ,GACb,MAAOqB,GACRd,EAAMN,OAAOoB,GAIf,MAAOd,GAAMZ,QAtFd,GAAII,GAAUN,EAAOM,SAAW8B,QAAQ,eAAe9B,QACnDe,EAAerB,EAAOqB,cAAgBe,QAAQ,eAyF3B,oBAAZC,SACVC,OAAOD,QAAU5B,EACW,kBAAX8B,QACjBA,OAAO,WACN,MAAO9B,KAGRT,EAAOwC,UAAY/B,GAEA,mBAAXT,QAAyBA,OAASyC","sourcesContent":["/**\r\n * localStorage persistent storage adapter for Har≈ç\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2015\r\n * @license BSD-3-Clause\r\n * @link https://github.com/avoidwork/haro-localStorage\r\n * @version 1.0.0\r\n */\n\"use strict\";\n\n(function (global) {\n\tvar Promise = global.Promise || require(\"es6-promise\").Promise;\n\tvar localStorage = global.localStorage || require(\"localStorage\");\n\n\tfunction deferred() {\n\t\tvar promise = undefined,\n\t\t    resolver = undefined,\n\t\t    rejecter = undefined;\n\n\t\tpromise = new Promise(function (resolve, reject) {\n\t\t\tresolver = resolve;\n\t\t\trejecter = reject;\n\t\t});\n\n\t\treturn { resolve: resolver, reject: rejecter, promise: promise };\n\t}\n\n\tfunction local(store, op, key, data) {\n\t\tvar defer = deferred(),\n\t\t    record = key !== undefined && store.has(key),\n\t\t    prefix = store.adapters.local || store.id,\n\t\t    result = undefined;\n\n\t\tif (op === \"get\") {\n\t\t\tif (record) {\n\t\t\t\tresult = localStorage.getItem(prefix + \"_\" + key);\n\n\t\t\t\tif (result !== null) {\n\t\t\t\t\tresult = JSON.parse(result);\n\t\t\t\t\tstore.set(key, result, true).then(function (rec) {\n\t\t\t\t\t\tdefer.resolve(rec);\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdefer.reject(new Error(\"Record not found in localStorage\"));\n\t\t\t\t}\n\n\t\t\t\tstore.set(key, result, true).then(function (rec) {\n\t\t\t\t\tdefer.resolve(rec);\n\t\t\t\t}, function (e) {\n\t\t\t\t\tdefer.reject(e);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresult = localStorage.getItem(prefix);\n\n\t\t\t\tif (result !== null) {\n\t\t\t\t\tresult = JSON.parse(result);\n\t\t\t\t\tstore.batch(result, \"set\").then(function (args) {\n\t\t\t\t\t\tdefer.resolve(args);\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (op === \"remove\") {\n\t\t\ttry {\n\t\t\t\tif (record) {\n\t\t\t\t\tlocalStorage.removeItem(prefix + \"_\" + key);\n\t\t\t\t} else {\n\t\t\t\t\tlocalStorage.removeItem(prefix);\n\t\t\t\t}\n\n\t\t\t\tdefer.resolve(true);\n\t\t\t} catch (e) {\n\t\t\t\tdefer.reject(e);\n\t\t\t}\n\t\t}\n\n\t\tif (op === \"set\") {\n\t\t\ttry {\n\t\t\t\tif (record) {\n\t\t\t\t\tlocalStorage.setItem(prefix + \"_\" + key, JSON.stringify(data));\n\t\t\t\t} else {\n\t\t\t\t\tlocalStorage.setItem(prefix, JSON.stringify(store.toArray()));\n\t\t\t\t}\n\n\t\t\t\tdefer.resolve(true);\n\t\t\t} catch (e) {\n\t\t\t\tdefer.reject(e);\n\t\t\t}\n\t\t}\n\n\t\treturn defer.promise;\n\t}\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = local;\n\t} else if (typeof define === \"function\") {\n\t\tdefine(function () {\n\t\t\treturn local;\n\t\t});\n\t} else {\n\t\tglobal.haroLocal = local;\n\t}\n})(typeof global !== \"undefined\" ? global : window);\n"]}